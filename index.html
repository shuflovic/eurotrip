<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading Bingo Challenge</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS Variables & Theming --- */
        :root {
            /* Light Mode (Default) */
            --bg-color: #fafafa;
            --card-bg: #ffffff;
            --text-main: #111111;
            --text-muted: #888888;
            --border-color: #eaeaea;
            --accent-primary: #2c3e50;
            
            --shadow-soft: 0 10px 40px rgba(0,0,0,0.04);
            --shadow-float: 0 4px 12px rgba(0,0,0,0.02);
        }

        /* Dark Mode Override */
        body.dark-mode {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --border-color: #333333;
            --accent-primary: #ffffff;
            
            --shadow-soft: 0 10px 40px rgba(0,0,0,0.3);
            --shadow-float: 0 4px 12px rgba(0,0,0,0.2);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        #icon-moon {
            display: none;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 60px 20px;
            width: 100%;
            position: relative;
        }

        /* --- Header & Toggle --- */
        header {
            text-align: center;
            margin-bottom: 40px;
            max-width: 600px;
            width: 100%;
            position: relative; /* Context for toggle button */
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            font-weight: 400;
            letter-spacing: -1px;
            margin-bottom: 10px;
            color: var(--text-main);
        }

        .subtitle {
            font-size: 0.8rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 20px;
            display: block;
        }

        /* Toggle Button Styling */
        .theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: transparent;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-main);
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background-color: var(--card-bg);
            border-color: var(--text-muted);
            transform: rotate(15deg);
        }

        .theme-toggle svg {
            width: 20px;
            height: 20px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* --- The Art Card --- */
        .art-frame {
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            padding: 2px;
            border-radius: 2px;
            box-shadow: var(--shadow-soft);
            position: relative;
            transition: background-color 0.3s ease;
        }

        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 1px;
            background-color: var(--border-color);
            border: 1px solid var(--border-color);
            aspect-ratio: 1 / 1;
        }

        .bingo-cell {
            background-color: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.7rem;
            padding: 10px 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            position: relative;
            color: var(--text-main);
            line-height: 1.4;
            aspect-ratio: 1 / 1; /* Add this line */
            overflow: hidden; /* Add this to prevent text overflow */
        }

        .bingo-cell:hover {
            background-color: var(--bg-color); /* Slightly distinct from card bg */
        }

        /* Marked State */
        .bingo-cell.marked {
            background-color: var(--bg-color);
            position: relative;
            opacity: 0.6;
        }
        
        .bingo-cell.marked span {
            text-decoration: line-through;
            text-decoration-color: var(--text-muted);
        }
        
        .bingo-cell.marked::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            background-color: var(--text-main);
            border-radius: 50%;
            top: 8px;
            right: 8px;
        }

        .bingo-cell.free-space {
            background-color: var(--text-main); /* Inverted contrast */
            color: var(--bg-color);
            font-style: italic;
        }

        .bingo-cell.winner {
            background-color: var(--text-main);
            color: var(--bg-color);
            opacity: 1;
        }
        
        .bingo-cell.winner span {
            text-decoration: none;
        }

        /* --- Bottom Part --- */
        .bottom-bar {
            width: 100%;
            max-width: 600px;
            margin-top: 30px;
            padding: 0 10px 10px 10px;
        }

        .status-pill {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 16px 20px;
            background: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
            box-shadow: var(--shadow-float);
            transition: transform 0.3s ease, background-color 0.3s ease;
        }
        
        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .status-count {
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-main);
        }
        
        .progress-bar-container {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: var(--text-main);
            border-radius: 4px;
            transition: width 0.4s ease;
            width: 4%;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button.control-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-main);
            padding-bottom: 4px;
            position: relative;
            transition: color 0.3s ease;
        }

        button.control-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background-color: var(--text-main);
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.3s ease;
        }

        button.control-btn:hover::after {
            transform: scaleX(1);
            transform-origin: left;
        }
        
        button.control-btn.share-btn {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        button.control-btn.share-btn svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .site-footer {
            text-align: center;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
        }

        .site-footer p {
            color: var(--text-muted);
            font-size: 0.65rem;
        }

        .site-footer a:hover {
            color: var(--text-main);
        }

        @media (max-width: 600px) {
            .bottom-bar {
                position: sticky;
                bottom: 0;
                background: var(--bg-color);
                -webkit-backdrop-filter: blur();
                backdrop-filter: blur(10px);
                margin-top: auto;
                padding-top: 10px;
                border-top: 1px solid var(--border-color);
                z-index: 100;
            }
            h1 { font-size: 2.5rem; }
        }

        /* --- Toast --- */
        #toast {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background-color: var(--text-main);
            color: var(--bg-color);
            padding: 10px 24px;
            border-radius: 4px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease, transform 0.4s ease;
            z-index: 200;
            letter-spacing: 0.5px;
        }

        #toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* --- Canvas --- */
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div class="wrapper">
        <header>
            <h1>Reading Bingo</h1><br>
            <span class="subtitle">Read a Book:</span>
            
            <!-- Theme Toggle Button -->
            <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle Dark Mode">
                <!-- Sun Icon (Default) -->
                <svg id="icon-sun" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <!-- Moon Icon (Hidden by default in CSS logic) -->
                <svg id="icon-moon" viewBox="0 0 24 24">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
        </header>

        <main class="art-frame">
            <div class="bingo-grid" id="bingo-grid">
                <!-- Grid generated by JS -->
            </div>
        </main>

        <div class="bottom-bar">
            <div class="status-pill">
                <div class="status-header">
                    <span class="status-label">Progress</span>
                    <span class="status-count" id="progress-count">1 / 25</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-bar"></div>
                </div>
            </div>

            <div class="controls">
                <button class="control-btn share-btn" onclick="shareProgress()">
                    <svg viewBox="0 0 24 24">
                        <circle cx="18" cy="5" r="3"></circle>
                        <circle cx="6" cy="12" r="3"></circle>
                        <circle cx="18" cy="19" r="3"></circle>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                    </svg>
                    Share
                </button>
                <button class="control-btn" onclick="shuffleBoard()">Shuffle Board</button>
                <button class="control-btn" onclick="resetBoard()">Reset</button>
            </div>

            <footer class="site-footer">
            <p>&copy; 2026 Created by Shuflovic</p>
            </footer>
        </div>
    </div>

    <div id="toast"></div>

    <script>
        // --- 1. Theme Logic ---
        function toggleTheme() {
            const body = document.body;
            const sunIcon = document.getElementById('icon-sun');
            const moonIcon = document.getElementById('icon-moon');
            
            body.classList.toggle('dark-mode');
            
            const isDark = body.classList.contains('dark-mode');
            
            // Toggle Icons
            if(isDark) {
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
            } else {
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
            }

            // Save preference
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        // Check system preference on load
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.body.classList.add('dark-mode');
                document.getElementById('icon-sun').style.display = 'none';
                document.getElementById('icon-moon').style.display = 'block';
            } else {
                document.getElementById('icon-sun').style.display = 'block';
                document.getElementById('icon-moon').style.display = 'none';
            }
        }

        // --- 2. Game Data & Logic ---
        const initialTasks = [
            "On TBR over 5 years",
            "Set in a country you've never visited",
            "You would normally judge",
            "Your boyfriend picks for you",
            "Published this year",
            "A trilogy/series",
            "5 books on your physical TBR",
            "With a title longer than 7 words",
            "The first book you touch on a shelf (TBR)",
            "People lie about reading",
            "A whole audiobook while knitting",
            "That was published the year you were born",
            "FREE",
            "Non-fiction",
            "Poetry collection",
            "Sci-fi or dystopian",
            "With red cover",
            "Unread book",
            "You can't pronounce the author's name",
            "You can finish in a day",
            "Large one (over 700p)",
            "Because the cover is ridiculous",
            "Classic novel",
            "With a number in the title",
            "You saw on Instagram"
        ];

        let currentTasks = [];
        let markedState = new Array(25).fill(false);
        let previousBingoCount = 0; // Track previous bingo count
        
        const winPatterns = [
            [0, 1, 2, 3, 4], [5, 6, 7, 8, 9], [10, 11, 12, 13, 14], [15, 16, 17, 18, 19], [20, 21, 22, 23, 24],
            [0, 5, 10, 15, 20], [1, 6, 11, 16, 21], [2, 7, 12, 17, 22], [3, 8, 13, 18, 23], [4, 9, 14, 19, 24],
            [0, 6, 12, 18, 24], [4, 8, 12, 16, 20]
        ];

        const gridElement = document.getElementById('bingo-grid');
        const progressElement = document.getElementById('progress-count');
        const progressBarElement = document.getElementById('progress-bar');
        const toastElement = document.getElementById('toast');

        function init() {
            initTheme(); // Initialize theme first
            currentTasks = [...initialTasks];
            renderGrid();
            updateProgress();
        }

        function renderGrid() {
            gridElement.innerHTML = ''; 
            currentTasks.forEach((task, index) => {
                const cell = document.createElement('div');
                cell.className = 'bingo-cell';
                if (markedState[index]) cell.classList.add('marked');
                if (task === "FREE") cell.classList.add('free-space');

                const span = document.createElement('span');
                span.textContent = task;
                cell.appendChild(span);

                cell.onclick = () => toggleMark(index);
                cell.setAttribute('role', 'button');
                cell.setAttribute('aria-pressed', markedState[index]);
                gridElement.appendChild(cell);
            });
        }

        function toggleMark(index) {
            markedState[index] = !markedState[index];
            const cells = gridElement.children;
            cells[index].classList.toggle('marked');
            cells[index].setAttribute('aria-pressed', markedState[index]);
            updateProgress();
            checkWin();
        }

        function updateProgress() {
            const count = markedState.filter(Boolean).length;
            const percentage = (count / 25) * 100;
            progressElement.textContent = `${count} / 25`;
            progressBarElement.style.width = `${percentage}%`;
        }

        function checkWin() {
            const cells = gridElement.children;
            let currentBingoCount = 0;
            
            // Remove all winner classes first
            Array.from(cells).forEach(c => c.classList.remove('winner'));

            // Count and mark all bingo lines
            for (const pattern of winPatterns) {
                if (pattern.every(index => markedState[index])) {
                    currentBingoCount++;
                    pattern.forEach(index => cells[index].classList.add('winner'));
                }
            }

            // Fire confetti for each NEW bingo line achieved
            if (currentBingoCount > previousBingoCount) {
                const newBingos = currentBingoCount - previousBingoCount;
                
                if (newBingos === 1) {
                    showToast("Bingo Completed!");
                } else {
                    showToast(`${newBingos} New Bingos!`);
                }
                
                fireConfetti();
                previousBingoCount = currentBingoCount;
            } else if (currentBingoCount < previousBingoCount) {
                // User unmarked something, update the count
                previousBingoCount = currentBingoCount;
            }
        }

        function shuffleBoard() {
            if (!confirm('Shuffle the board? Your progress will be kept.')) {
                return;
            }
            
            // Save current marked tasks (excluding FREE)
            const markedTasks = currentTasks.filter((task, index) => 
                markedState[index] && task !== 'FREE'
            );
            
            const freeTask = "FREE";
            const otherTasks = initialTasks.filter(t => t !== freeTask);
            for (let i = otherTasks.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [otherTasks[i], otherTasks[j]] = [otherTasks[j], otherTasks[i]];
            }
            const newTasks = [...otherTasks.slice(0, 12), freeTask, ...otherTasks.slice(12)];
            currentTasks = newTasks;
            
            // Restore marked state based on tasks
            markedState = new Array(25).fill(false);
            
            currentTasks.forEach((task, index) => {
                if (markedTasks.includes(task)) {
                    markedState[index] = true;
                }
            });
            
            // Recalculate bingo count after shuffle
            let currentBingoCount = 0;
            for (const pattern of winPatterns) {
                if (pattern.every(index => markedState[index])) {
                    currentBingoCount++;
                }
            }
            previousBingoCount = currentBingoCount;
            
            renderGrid();
            updateProgress();
            checkWin(); // Update winner highlighting
            showToast("Board Curated");
        }

       function resetBoard() {
        if (!confirm('Reset all progress? This cannot be undone.')) {
            return;
        }
        
        markedState = new Array(25).fill(false);
        //markedState[12] = true;   REMOVE THIS LINE
        previousBingoCount = 0; // Reset bingo count
        renderGrid();
        updateProgress();
        showToast("Board Reset");
        }

        function showToast(message) {
            toastElement.textContent = message;
            toastElement.className = "show";
            setTimeout(() => { toastElement.className = toastElement.className.replace("show", ""); }, 3000);
        }

        // --- Share Progress Function ---
        function shareProgress() {
            const completed = currentTasks.filter((task, index) => 
                markedState[index] && task !== 'FREE'
            );
            
            // Count bingo lines
            let bingoCount = 0;
            for (const pattern of winPatterns) {
                if (pattern.every(index => markedState[index])) {
                    bingoCount++;
                }
            }
            
            let message = `ðŸ“š READING BINGO 2026 ðŸ“š\n\n`;
            message += `Progress: ${markedState.filter(Boolean).length}/25 books archived\n`;
            message += `Bingo Lines: ${bingoCount}\n\n`;
            
            if (completed.length > 0) {
                message += `Completed Tasks:\n`;
                completed.forEach(task => {
                    message += `â—† ${task}\n`;
                });
            }
                
            message += `\nshuflovic.github.io/bingo-reading-cart`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Reading Bingo 2026 Progress',
                    text: message
                }).catch(() => {
                    copyToClipboard(message);
                });
            } else {
                copyToClipboard(message);
            }
        }

        function copyToClipboard(text) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast("Progress copied to clipboard!");
                }).catch(() => {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }

        function fallbackCopy(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                showToast("Progress copied to clipboard!");
            } catch (err) {
                showToast("Could not copy progress");
            }
            document.body.removeChild(textarea);
        }

        // --- 3. Confetti Engine ---
        const canvas = document.getElementById("confetti-canvas");
        const ctx = canvas.getContext("2d");
        let particles = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function fireConfetti() {
            particles = [];
            // Use theme-aware colors for confetti (or neutral) - let's go neutral/vibrant
            const colors = ['#2c3e50', '#e74c3c', '#f1c40f', '#2ecc71', '#ffffff'];
            for (let i = 0; i < 100; i++) {
                particles.push({
                    x: window.innerWidth / 2,
                    y: window.innerHeight / 2,
                    w: Math.random() * 6 + 4,
                    h: Math.random() * 10 + 6,
                    vx: (Math.random() - 0.5) * 20,
                    vy: (Math.random() - 0.5) * 20,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    life: 120
                });
            }
            requestAnimationFrame(updateConfetti);
        }

        function updateConfetti() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach((p, index) => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.4;
                p.life--;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, p.w, p.h);
                if (p.life <= 0) particles.splice(index, 1);
            });
            if (particles.length > 0) requestAnimationFrame(updateConfetti);
        }

        // Start
        init();
    </script>
</body>
</html>
